package generator

//
//import (
//	"bufio"
//	"fmt"
//	"go/ast"
//	"go/parser"
//	"go/token"
//	"os"
//	"path/filepath"
//	"strings"
//	"text/template"
//)
//
//// ç”Ÿæˆå¯¼å…¥ä»£ç çš„æ¨¡æ¿ï¼ˆæ–°å¢æ—¥å¿—æç¤ºï¼‰
//const routeImportTpl = `// Code generated by go-common auto-gen; DO NOT EDIT.
//// è­¦å‘Šï¼šæ­¤æ–‡ä»¶ç”±go-commonè‡ªåŠ¨ç”Ÿæˆï¼Œåˆ é™¤/ä¿®æ”¹ä¼šå¯¼è‡´è·¯ç”±æ³¨å†Œå¤±æ•ˆï¼
//package {{.PackageName}}
//
//import (
// "fmt"
//{{range .Routes}}
//	_ "{{.ModuleName}}/{{.Path}}"
//{{end}}
//)
//
//// Init æ ¸å¿ƒå‡½æ•°ï¼šé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æ‰ä¸Šè¿°è·¯ç”±åŒ…çš„å¯¼å…¥
//// ğŸ”´ é‡è¦æé†’ï¼šè¯·å‹¿åˆ é™¤/ä¿®æ”¹æ­¤å‡½æ•°ï¼
//// ä½œç”¨ï¼šå³ä½¿æ²¡æœ‰å…¶ä»–ä»£ç å¼•ç”¨è¿™äº›è·¯ç”±åŒ…ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šä¿ç•™å¯¼å…¥ï¼Œè§¦å‘è·¯ç”±åŒ…çš„init()å‡½æ•°æ‰§è¡Œ
//// åˆ é™¤åæœï¼šæ‰€æœ‰è·¯ç”±åŒ…çš„init()ä¸ä¼šæ‰§è¡Œï¼Œè·¯ç”±æ³¨å†Œå¤±æ•ˆï¼Œæ¥å£404
//func init() {
//	// å¯åŠ¨æ—¶æ‰“å°æç¤ºï¼Œå¼ºåŒ–è®¤çŸ¥ï¼ˆä»…debugçº§åˆ«ï¼Œä¸å½±å“ç”Ÿäº§ï¼‰
//	if true { // é¿å…ç¼–è¯‘å™¨ä¼˜åŒ–æ‰æ—¥å¿—ï¼ˆå®é™…å¯ç»“åˆlogçº§åˆ«æ§åˆ¶ï¼‰
//		fmt.Printf("[è·¯ç”±è‡ªåŠ¨å¯¼å…¥] å·²åŠ è½½ %d ä¸ªè·¯ç”±åŒ…ï¼ŒInit()å‡½æ•°æ­£å¸¸ç”Ÿæ•ˆï¼ˆè¯·å‹¿åˆ é™¤æ­¤å‡½æ•°ï¼‰\n", len([]interface{}{ {{range .Routes}}nil,{{end}} }))
//	}
//}
//`
//
//// RouteGenInfo è·¯ç”±åŒ…ä¿¡æ¯
//type RouteGenInfo struct {
//	ModuleName string // ä¸šåŠ¡é¡¹ç›®çš„go moduleåï¼ˆå¦‚pano-materialï¼‰
//	Path       string // è·¯ç”±åŒ…ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚testã€lectureï¼‰
//}
//
//// RouteGenConfig ç”Ÿæˆé…ç½®
//type RouteGenConfig struct {
//	PackageName string         // ç”Ÿæˆæ–‡ä»¶çš„åŒ…åï¼ˆé»˜è®¤routesï¼‰
//	Routes      []RouteGenInfo // æ‰«æåˆ°çš„è·¯ç”±åŒ…
//}
//
//// AutoGenRouteImport è‡ªåŠ¨ç”Ÿæˆè·¯ç”±å¯¼å…¥ä»£ç ï¼ˆæ”¯æŒé€šé…ç¬¦åŒ¹é…ï¼‰
//// å‚æ•°è¯´æ˜ï¼š
//// - moduleName: ä¸šåŠ¡é¡¹ç›®çš„go moduleåï¼ˆå¿…å¡«ï¼Œå¦‚pano-materialï¼‰
//// - scanRoot: æ‰«æçš„æ ¹ç›®å½•ï¼ˆé»˜è®¤å½“å‰ç›®å½•ï¼Œä¼ ""åˆ™ç”¨å½“å‰å·¥ä½œç›®å½•ï¼‰
//// - outputDir: ç”Ÿæˆæ–‡ä»¶çš„ç›®å½•ï¼ˆé»˜è®¤routesï¼‰
//// - matchPatterns: é€šé…ç¬¦åŒ¹é…è§„åˆ™ï¼ˆé€—å·åˆ†éš”ï¼Œé»˜è®¤test,lecture,handler,*Route,*routerï¼‰
//// - ignoreDirs: å¿½ç•¥çš„ç›®å½•å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼Œé»˜è®¤vendor,testdata,docsï¼‰
//func AutoGenRouteImport(moduleName, scanRoot, outputDir, matchPatterns, ignoreDirs string) error {
//	// 1. å‚æ•°é»˜è®¤å€¼å¤„ç†
//	if scanRoot == "" {
//		var err error
//		scanRoot, err = os.Getwd() // è·å–å½“å‰å·¥ä½œç›®å½•
//		if err != nil {
//			return fmt.Errorf("è·å–å½“å‰ç›®å½•å¤±è´¥ï¼š%v", err)
//		}
//	}
//	if outputDir == "" {
//		outputDir = "routes" // é»˜è®¤ç”Ÿæˆåˆ°routesç›®å½•
//	}
//	// é»˜è®¤æ”¯æŒçš„é€šé…ç¬¦è§„åˆ™ï¼šç²¾ç¡®åŒ¹é…+æ¨¡ç³ŠåŒ¹é…
//	if matchPatterns == "" {
//		matchPatterns = "test,lecture,handler,*Route,*router,handler/*"
//	}
//	if ignoreDirs == "" {
//		ignoreDirs = "vendor,testdata,docs,node_modules,.git,.idea"
//	}
//	if moduleName == "" {
//		return fmt.Errorf("moduleNameä¸èƒ½ä¸ºç©ºï¼ˆè¯·ä¼ å…¥ä¸šåŠ¡é¡¹ç›®çš„go moduleåï¼Œå¦‚pano-materialï¼‰")
//	}
//
//	// 2. åˆ›å»ºroutesç›®å½•ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
//	if err := os.MkdirAll(outputDir, 0755); err != nil {
//		return fmt.Errorf("åˆ›å»ºroutesç›®å½•å¤±è´¥ï¼š%v", err)
//	}
//
//	// 3. è§£æåŒ¹é…è§„åˆ™ï¼ˆæ‹†åˆ†ä¸ºé€šé…ç¬¦åˆ—è¡¨ï¼‰
//	matchList := strings.Split(matchPatterns, ",")
//	// æ¸…ç†ç©ºè§„åˆ™
//	for i := len(matchList) - 1; i >= 0; i-- {
//		matchList[i] = strings.TrimSpace(matchList[i])
//		if matchList[i] == "" {
//			matchList = append(matchList[:i], matchList[i+1:]...)
//		}
//	}
//
//	// 4. è§£æå¿½ç•¥ç›®å½•è§„åˆ™
//	ignoreList := make(map[string]bool)
//	for _, dir := range strings.Split(ignoreDirs, ",") {
//		dir = strings.TrimSpace(dir)
//		if dir != "" {
//			ignoreList[dir] = true
//		}
//	}
//
//	// 5. æ‰«æç›®å½•ï¼Œæ”¶é›†è·¯ç”±åŒ…ï¼ˆæ ¸å¿ƒï¼šé€šé…ç¬¦åŒ¹é…ï¼‰
//	var routes []RouteGenInfo
//	err := filepath.Walk(scanRoot, func(path string, info os.FileInfo, err error) error {
//		if err != nil {
//			return err
//		}
//
//		// è·³è¿‡éç›®å½•ã€æ ¹ç›®å½•ã€å¿½ç•¥ç›®å½•
//		if !info.IsDir() || path == scanRoot || ignoreList[filepath.Base(path)] {
//			return nil
//		}
//
//		// è·å–å½“å‰ç›®å½•çš„åŸºç¡€åï¼ˆå¦‚handler/user â†’ userï¼›orderRoute â†’ orderRouteï¼‰
//		dirBase := filepath.Base(path)
//		// è·å–å½“å‰ç›®å½•çš„å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼ˆç”¨äºåŒ¹é…handler/*è¿™ç±»è·¯å¾„è§„åˆ™ï¼‰
//		relPath, _ := filepath.Rel(scanRoot, path)
//		// ç»Ÿä¸€è½¬ä¸ºæ–œæ ï¼ˆå…¼å®¹Windowsï¼‰
//		relPath = filepath.ToSlash(relPath)
//
//		// éå†æ‰€æœ‰åŒ¹é…è§„åˆ™ï¼Œåªè¦æ»¡è¶³ä¸€ä¸ªå°±è§†ä¸ºåŒ¹é…æˆåŠŸ
//		matchSuccess := false
//		for _, pattern := range matchList {
//			// è§„åˆ™1ï¼šåŒ¹é…ç›®å½•åŸºç¡€åï¼ˆå¦‚*Routeã€*routerï¼‰
//			if ok, _ := filepath.Match(pattern, dirBase); ok {
//				matchSuccess = true
//				break
//			}
//			// è§„åˆ™2ï¼šåŒ¹é…å®Œæ•´ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚handler/*ï¼‰
//			if ok, _ := filepath.Match(pattern, relPath); ok {
//				matchSuccess = true
//				break
//			}
//		}
//
//		// åŒ¹é…æˆåŠŸåˆ™åŠ å…¥è·¯ç”±åˆ—è¡¨
//		if matchSuccess {
//			routes = append(routes, RouteGenInfo{
//				ModuleName: moduleName,
//				Path:       relPath,
//			})
//			fmt.Printf("[go-common] åŒ¹é…åˆ°è·¯ç”±åŒ…ï¼š%s/%s\n", moduleName, relPath)
//		}
//		return nil
//	})
//	if err != nil {
//		return fmt.Errorf("æ‰«æè·¯ç”±ç›®å½•å¤±è´¥ï¼š%v", err)
//	}
//
//	// 6. ç”Ÿæˆå¯¼å…¥ä»£ç 
//	config := RouteGenConfig{
//		PackageName: filepath.Base(outputDir), // åŒ…åé»˜è®¤æ˜¯ç›®å½•åï¼ˆroutesï¼‰
//		Routes:      routes,
//	}
//	tpl, err := template.New("routeImport").Parse(routeImportTpl)
//	if err != nil {
//		return fmt.Errorf("è§£ææ¨¡æ¿å¤±è´¥ï¼š%v", err)
//	}
//
//	// 7. å†™å…¥auto_import.goæ–‡ä»¶
//	outputFile := filepath.Join(outputDir, "auto_import.go")
//	f, err := os.Create(outputFile)
//	if err != nil {
//		return fmt.Errorf("åˆ›å»ºauto_import.goå¤±è´¥ï¼š%v", err)
//	}
//	defer f.Close()
//	if err := tpl.Execute(f, config); err != nil {
//		return fmt.Errorf("ç”Ÿæˆauto_import.goå†…å®¹å¤±è´¥ï¼š%v", err)
//	}
//
//	// ========== æ–°å¢æ ¸å¿ƒé€»è¾‘ï¼šæ£€æŸ¥å¹¶æ³¨å…¥ä¸šåŠ¡main.go ==========
//	if len(routes) > 0 { // ä»…å½“æœ‰è·¯ç”±åŒ…æ—¶æ‰æ£€æŸ¥
//		// 1. æŸ¥æ‰¾ä¸šåŠ¡é¡¹ç›®çš„main.go
//		mainGoPath, err := findMainGo(scanRoot)
//		if err != nil {
//			fmt.Printf("[go-common] è­¦å‘Šï¼šæŸ¥æ‰¾main.goå¤±è´¥ï¼ˆä¸å½±å“è·¯ç”±ç”Ÿæˆï¼‰ï¼š%v\n", err)
//		} else {
//			// 2. æ£€æŸ¥æ˜¯å¦å·²è°ƒç”¨routes.Init()
//			//hasInit, err := checkMainHasRoutesInit(mainGoPath)
//			hasInit, err := CheckMainHasValidRoutesInit(mainGoPath, moduleName, outputDir)
//			if err != nil {
//				fmt.Printf("[go-common] è­¦å‘Šï¼šæ£€æŸ¥main.goçš„routes.Init()å¤±è´¥ï¼š%v\n", err)
//			} else if !hasInit { // 3. æœªè°ƒç”¨åˆ™è‡ªåŠ¨æ³¨å…¥
//				//if err := injectRoutesInitToMain(mainGoPath, moduleName, outputDir); err != nil {
//				if err := InjectRoutesInitToMain(mainGoPath, moduleName, outputDir); err != nil {
//					fmt.Printf("[go-common] è­¦å‘Šï¼šè‡ªåŠ¨æ³¨å…¥routes.Init()å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨æ·»åŠ ï¼š%v\n", err)
//				}
//			} else {
//				fmt.Printf("[go-common] main.goå·²åŒ…å«routes.Init()è°ƒç”¨ï¼Œæ— éœ€æ³¨å…¥\n")
//			}
//		}
//	}
//	fmt.Printf("[go-common] æˆåŠŸç”Ÿæˆè·¯ç”±å¯¼å…¥æ–‡ä»¶ï¼š%sï¼ˆå…±%dä¸ªè·¯ç”±åŒ…ï¼‰\n", outputFile, len(routes))
//	return nil
//}
//
//// ---------------------- æ–°å¢ï¼šä¸šåŠ¡main.goæ£€æŸ¥+æ³¨å…¥é€»è¾‘ ----------------------
//// findMainGo æŸ¥æ‰¾ä¸šåŠ¡é¡¹ç›®çš„main.goæ–‡ä»¶ï¼ˆä»æ‰«ææ ¹ç›®å½•å‘ä¸‹æ‰¾ï¼‰
//func findMainGo(scanRoot string) (string, error) {
//	var mainPath string
//	err := filepath.Walk(scanRoot, func(path string, info os.FileInfo, err error) error {
//		if err != nil {
//			return err
//		}
//		// æ‰¾åˆ°main.goæ–‡ä»¶ï¼ˆä¸”æ˜¯mainåŒ…ï¼‰
//		if !info.IsDir() && strings.HasSuffix(path, "main.go") {
//			// å¿«é€Ÿæ£€æŸ¥æ˜¯å¦æ˜¯mainåŒ…ï¼ˆé¿å…åŒ¹é…æµ‹è¯•æ–‡ä»¶ï¼‰
//			file, err := os.Open(path)
//			if err != nil {
//				return nil // è·³è¿‡æ— æ³•è¯»å–çš„æ–‡ä»¶
//			}
//			defer file.Close()
//
//			scanner := bufio.NewScanner(file)
//			for scanner.Scan() {
//				line := strings.TrimSpace(scanner.Text())
//				if line == "package main" {
//					mainPath = path
//					return filepath.SkipAll // æ‰¾åˆ°åç»ˆæ­¢éå†
//				}
//			}
//		}
//		return nil
//	})
//	if err != nil {
//		return "", fmt.Errorf("éå†æŸ¥æ‰¾main.goå¤±è´¥ï¼š%v", err)
//	}
//	if mainPath == "" {
//		return "", fmt.Errorf("åœ¨æ‰«æç›®å½•[%s]ä¸‹æœªæ‰¾åˆ°mainåŒ…çš„main.goæ–‡ä»¶", scanRoot)
//	}
//	return mainPath, nil
//}
//
//// checkMainHasRoutesInit æ£€æŸ¥ä¸šåŠ¡main.goæ˜¯å¦è°ƒç”¨äº†routes.Init()
//func checkMainHasRoutesInit(mainGoPath string) (bool, error) {
//	// è§£æmain.goçš„ASTè¯­æ³•æ ‘
//	fset := token.NewFileSet()
//	file, err := parser.ParseFile(fset, mainGoPath, nil, parser.AllErrors)
//	if err != nil {
//		return false, fmt.Errorf("è§£æmain.goå¤±è´¥ï¼š%v", err)
//	}
//
//	hasInit := false
//	// éå†ASTæ‰¾mainå‡½æ•°ä¸­çš„routes.Init()è°ƒç”¨
//	ast.Inspect(file, func(n ast.Node) bool {
//		// åŒ¹é…mainå‡½æ•°å£°æ˜
//		funcDecl, ok := n.(*ast.FuncDecl)
//		if ok && funcDecl.Name.Name == "main" && funcDecl.Type.Results == nil {
//			// éå†mainå‡½æ•°ä½“çš„æ‰€æœ‰è¯­å¥
//			for _, stmt := range funcDecl.Body.List {
//				// åŒ¹é…è¡¨è¾¾å¼è¯­å¥ï¼ˆå¦‚ routes.Init()ï¼‰
//				exprStmt, ok := stmt.(*ast.ExprStmt)
//				if !ok {
//					continue
//				}
//				// åŒ¹é…å‡½æ•°è°ƒç”¨
//				callExpr, ok := exprStmt.X.(*ast.CallExpr)
//				if !ok {
//					continue
//				}
//				// åŒ¹é…routes.Inité€‰æ‹©å™¨
//				selExpr, ok := callExpr.Fun.(*ast.SelectorExpr)
//				if !ok {
//					continue
//				}
//				// åŒ¹é…åŒ…åå’Œå‡½æ•°å
//				ident, ok := selExpr.X.(*ast.Ident)
//				if ok && ident.Name == "routes" && selExpr.Sel.Name == "Init" {
//					hasInit = true
//					return false // æ‰¾åˆ°åç»ˆæ­¢éå†
//				}
//			}
//		}
//		return true
//	})
//
//	// é¢å¤–æ£€æŸ¥ï¼šæ˜¯å¦å¯¼å…¥äº†routesåŒ…
//	hasRoutesImport := false
//	for _, imp := range file.Imports {
//		importPath := strings.Trim(imp.Path.Value, `"`)
//		if importPath == "routes" || strings.HasSuffix(importPath, "/routes") {
//			hasRoutesImport = true
//			break
//		}
//	}
//
//	// å¿…é¡»åŒæ—¶æ»¡è¶³ï¼šå¯¼å…¥routesåŒ… + è°ƒç”¨routes.Init()
//	return hasInit && hasRoutesImport, nil
//}
//
//// injectRoutesInitToMain ç»™ä¸šåŠ¡é¡¹ç›®çš„main.goè‡ªåŠ¨æ³¨å…¥routesåŒ…å¯¼å…¥å’ŒInit()è°ƒç”¨
//// å‚æ•°è¯´æ˜ï¼š
////
////	mainGoPath: ä¸šåŠ¡é¡¹ç›®main.goçš„ç»å¯¹/ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ï¼š/usr/local/work/pano-material/main.goï¼‰
////	moduleName: ä¸šåŠ¡é¡¹ç›®çš„go modåç§°ï¼ˆå¦‚ï¼špano-materialï¼Œä»go.modè§£æçš„ï¼‰
////	outputDir: è·¯ç”±æ–‡ä»¶è¾“å‡ºç›®å½•ï¼ˆå¦‚ï¼šroutesï¼Œå³auto_import.goæ‰€åœ¨ç›®å½•ï¼‰
//func injectRoutesInitToMain(mainGoPath, moduleName, outputDir string) error {
//	// -------------------------- æ­¥éª¤1ï¼šå‡†å¤‡é€šç”¨å‚æ•° --------------------------
//	// 1. åŠ¨æ€ç”ŸæˆroutesåŒ…çš„å¯¼å…¥è·¯å¾„ï¼ˆæ ¸å¿ƒï¼šé€šç”¨åŒ–ï¼‰
//	// ç¤ºä¾‹ï¼šmoduleName=pano-material + outputDir=routes â†’ "pano-material/routes"
//	// ç¤ºä¾‹ï¼šmoduleName=new-project + outputDir=gen/routes â†’ "new-project/gen/routes"
//	routesImportPath := fmt.Sprintf("%s/%s", moduleName, outputDir)
//	routesImportPath = filepath.ToSlash(filepath.Clean(routesImportPath)) // æ¸…ç†è·¯å¾„ï¼ˆé¿å…//ã€../ï¼‰
//
//	// 2. è·¯ç”±åŒ…çš„è°ƒç”¨åˆ«åï¼ˆé»˜è®¤å–outputDiræœ€åä¸€çº§ï¼Œå¦‚gen/routes â†’ routesï¼‰
//	routesAlias := filepath.Base(outputDir)
//	// å¤„ç†ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœoutputDiræ˜¯æ ¹ç›®å½•ï¼ˆå¦‚/ï¼‰ï¼Œåˆ«åé»˜è®¤ç”¨routes
//	if routesAlias == "." || routesAlias == "/" {
//		routesAlias = "routes"
//	}
//
//	// -------------------------- æ­¥éª¤2ï¼šè¯»å–main.goå†…å®¹ --------------------------
//	// è¯»å–æ–‡ä»¶å†…å®¹å¹¶æŒ‰è¡Œæ‹†åˆ†
//	content, err := os.ReadFile(mainGoPath)
//	if err != nil {
//		return fmt.Errorf("è¯»å–main.goå¤±è´¥ï¼š%w", err)
//	}
//	lines := strings.Split(string(content), "\n")
//	originalLines := make([]string, len(lines)) // å¤‡ä»½åŸå†…å®¹
//	copy(originalLines, lines)
//
//	// -------------------------- æ­¥éª¤3ï¼šè‡ªåŠ¨æ·»åŠ routesåŒ…å¯¼å…¥ --------------------------
//	hasRoutesImport := false // æ˜¯å¦å·²å¯¼å…¥routesåŒ…
//	importBlockEndLine := -1 // import ( ... ) å—çš„ç»“æŸè¡Œå·
//	packageMainLine := -1    // package mainæ‰€åœ¨è¡Œå·
//
//	// éå†æ¯è¡Œï¼Œæ‰¾å…³é”®ä¿¡æ¯
//	for i, line := range lines {
//		trimLine := strings.TrimSpace(line)
//
//		// è®°å½•package mainçš„è¡Œå·
//		if trimLine == "package main" {
//			packageMainLine = i
//		}
//
//		// æ£€æŸ¥æ˜¯å¦å·²å¯¼å…¥ç›®æ ‡routesåŒ…
//		if strings.Contains(trimLine, fmt.Sprintf(`"%s"`, routesImportPath)) {
//			hasRoutesImport = true
//		}
//
//		// è®°å½•import ( ... ) å—çš„ç»“æŸè¡Œï¼ˆå¦‚import (ä¸‹çš„æœ€åä¸€è¡Œ)ï¼‰
//		if trimLine == ")" && importBlockEndLine == -1 {
//			// ç¡®è®¤ä¸Šä¸€è¡Œæ˜¯import (å¼€å¤´
//			if i > 0 && strings.HasPrefix(strings.TrimSpace(lines[i-1]), "import (") {
//				importBlockEndLine = i
//			}
//		}
//	}
//
//	// å¦‚æœæ²¡å¯¼å…¥routesåŒ…ï¼Œè‡ªåŠ¨æ·»åŠ 
//	if !hasRoutesImport {
//		// æƒ…å†µ1ï¼šæœ‰import ( ... ) å— â†’ æ’å…¥åˆ°å—å†…æœ€åä¸€è¡Œ
//		if importBlockEndLine > 0 {
//			// æ„é€ å¯¼å…¥è¡Œï¼ˆä¿æŒå’Œå…¶ä»–å¯¼å…¥ä¸€è‡´çš„ç¼©è¿›ï¼Œé»˜è®¤ç”¨\tï¼‰
//			importLine := fmt.Sprintf("\t\"%s\"", routesImportPath)
//			// åœ¨importå—ç»“æŸå‰æ’å…¥
//			newLines := append(lines[:importBlockEndLine], importLine)
//			newLines = append(newLines, lines[importBlockEndLine:]...)
//			lines = newLines
//		} else {
//			// æƒ…å†µ2ï¼šæ— importå— â†’ åœ¨package mainåæ·»åŠ å•è¡Œimport
//			if packageMainLine == -1 {
//				return fmt.Errorf("main.goä¸­æœªæ‰¾åˆ°package mainå£°æ˜ï¼Œæ— æ³•æ·»åŠ å¯¼å…¥")
//			}
//			// æ„é€ å•è¡Œå¯¼å…¥
//			importLine := fmt.Sprintf("import \"%s\"", routesImportPath)
//			// æ’å…¥åˆ°package mainä¸‹ä¸€è¡Œ
//			newLines := append(lines[:packageMainLine+1], importLine)
//			newLines = append(newLines, lines[packageMainLine+1:]...)
//			lines = newLines
//		}
//		fmt.Printf("[go-common] è‡ªåŠ¨ä¸ºmain.goæ·»åŠ å¯¼å…¥ï¼š%s\n", routesImportPath)
//	}
//
//	// -------------------------- æ­¥éª¤4ï¼šè‡ªåŠ¨æ’å…¥routes.Init()è°ƒç”¨ --------------------------
//	mainFuncStartLine := -1 // func main() { çš„è¡Œå·
//	// éå†æ‰¾mainå‡½æ•°å¼€å¤´
//	for i, line := range lines {
//		trimLine := strings.TrimSpace(line)
//		if trimLine == "func main() {" {
//			mainFuncStartLine = i
//			break
//		}
//	}
//
//	if mainFuncStartLine == -1 {
//		return fmt.Errorf("main.goä¸­æœªæ‰¾åˆ°func main() {}å‡½æ•°ï¼Œæ— æ³•æ’å…¥Init()è°ƒç”¨")
//	}
//
//	// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨Init()è°ƒç”¨ï¼ˆé¿å…é‡å¤æ’å…¥ï¼‰
//	hasInitCall := false
//	for i := mainFuncStartLine + 1; i < len(lines); i++ {
//		trimLine := strings.TrimSpace(lines[i])
//		// åŒ¹é…ï¼šroutes.Init() / gen_routes.Init() ç­‰
//		if strings.HasPrefix(trimLine, fmt.Sprintf("%s.Init()", routesAlias)) {
//			hasInitCall = true
//			break
//		}
//	}
//
//	// å¦‚æœæ²¡æœ‰Init()è°ƒç”¨ï¼Œæ’å…¥åˆ°mainå‡½æ•°ç¬¬ä¸€è¡Œ
//	if !hasInitCall {
//		// åŒ¹é…åŸæœ‰ç¼©è¿›ï¼ˆæ¯”å¦‚func main() { å‰é¢æœ‰2ä¸ª\tï¼Œå°±ç”¨åŒæ ·çš„ç¼©è¿›ï¼‰
//		indent := strings.Repeat("\t", strings.Count(lines[mainFuncStartLine], "\t"))
//		// æ„é€ Init()è°ƒç”¨è¡Œ
//		initCallLine := fmt.Sprintf("%s%s.Init()", indent, routesAlias)
//		// æ’å…¥åˆ°func main() { çš„ä¸‹ä¸€è¡Œ
//		newLines := append(lines[:mainFuncStartLine+1], initCallLine)
//		newLines = append(newLines, lines[mainFuncStartLine+1:]...)
//		lines = newLines
//		fmt.Printf("[go-common] è‡ªåŠ¨ä¸ºmain.goæ’å…¥è°ƒç”¨ï¼š%s.Init()\n", routesAlias)
//	}
//
//	// -------------------------- æ­¥éª¤5ï¼šå†™å›main.go --------------------------
//	// åªæœ‰å†…å®¹å˜åŒ–æ—¶æ‰å†™å…¥ï¼ˆé¿å…è¦†ç›–åŸæ–‡ä»¶ï¼‰
//	newContent := strings.Join(lines, "\n")
//	if newContent != strings.Join(originalLines, "\n") {
//		if err := os.WriteFile(mainGoPath, []byte(newContent), 0644); err != nil {
//			return fmt.Errorf("å†™å…¥main.goå¤±è´¥ï¼š%w", err)
//		}
//		fmt.Printf("[go-common] main.goå·²è‡ªåŠ¨æ›´æ–°å®Œæˆ\n")
//	} else {
//		fmt.Printf("[go-common] main.goæ— éœ€æ›´æ–°ï¼ˆå·²åŒ…å«routeså¯¼å…¥å’ŒInit()è°ƒç”¨ï¼‰\n")
//	}
//
//	return nil
//}
//
//// InjectRoutesInitToMain è‡ªåŠ¨ç»™ä¸šåŠ¡main.goæ³¨å…¥routes.Init()ï¼ˆå«å¯¼å…¥è¯­å¥+å‡½æ•°è°ƒç”¨ï¼‰
//func InjectRoutesInitToMain(mainGoPath, moduleName, outputDir string) error {
//
//	// 1. å…ˆæ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æœ‰æ•ˆä»£ç ï¼ˆé¿å…é‡å¤ï¼‰
//	hasValid, err := CheckMainHasValidRoutesInit(mainGoPath, moduleName, outputDir)
//	if err != nil {
//		return err
//	}
//	if hasValid {
//		fmt.Println("INFO: å·²å­˜åœ¨æœ‰æ•ˆroutes.Init()è°ƒç”¨ï¼Œæ— éœ€æ³¨å…¥")
//		return nil
//	}
//
//	// 1. è¯»å–main.goå†…å®¹
//	content, err := os.ReadFile(mainGoPath)
//	if err != nil {
//		return fmt.Errorf("è¯»å–main.goå¤±è´¥ï¼š%v", err)
//	}
//	lines := strings.Split(string(content), "\n")
//	// 2. æ­¥éª¤1ï¼šæ£€æŸ¥æ˜¯å¦å¯¼å…¥routesåŒ…ï¼Œæ— åˆ™æ·»åŠ 
//	hasRoutesImport := false
//	importEndLine := -1
//	for i, line := range lines {
//		trimmed := strings.TrimSpace(line)
//		// åŒ¹é…å¯¼å…¥è¯­å¥
//		if strings.HasPrefix(trimmed, "import (") || strings.HasPrefix(trimmed, "import \"") {
//			if strings.Contains(trimmed, "routes") {
//				hasRoutesImport = true
//			}
//		}
//		// è®°å½•importå—ç»“æŸä½ç½®
//		if trimmed == ")" && importEndLine == -1 && i > 0 && strings.HasPrefix(strings.TrimSpace(lines[i-1]), "import (") {
//			importEndLine = i
//		}
//	}
//	// æ— routeså¯¼å…¥åˆ™æ·»åŠ 
//	if !hasRoutesImport {
//		if importEndLine == -1 {
//			// æ— importå—ï¼Œåœ¨package mainåæ·»åŠ 
//			packageLine := -1
//			for i, line := range lines {
//				if strings.TrimSpace(line) == "package main" {
//					packageLine = i
//					break
//				}
//			}
//			if packageLine == -1 {
//				return fmt.Errorf("main.goä¸­æœªæ‰¾åˆ°package mainå£°æ˜")
//			}
//			// åœ¨package mainåæ’å…¥å¯¼å…¥
//			newLines := append(lines[:packageLine+1], `import "pano-material/routes"`)
//			newLines = append(newLines, lines[packageLine+1:]...)
//			lines = newLines
//		} else {
//			// æœ‰importå—ï¼Œåœ¨å—å†…æ·»åŠ 
//			newLines := append(lines[:importEndLine], `	"pano-material/routes"`)
//			newLines = append(newLines, lines[importEndLine:]...)
//			lines = newLines
//		}
//		fmt.Printf("[go-common] å·²ä¸ºmain.goæ·»åŠ routesåŒ…å¯¼å…¥\n")
//	}
//	// 3. æ­¥éª¤2ï¼šåœ¨mainå‡½æ•°ç¬¬ä¸€è¡Œæ’å…¥routes.Init()
//	mainFuncLine := -1
//	for i, line := range lines {
//		trimmed := strings.TrimSpace(line)
//		if trimmed == "func main() {" {
//			mainFuncLine = i
//			break
//		}
//	}
//	if mainFuncLine == -1 {
//		return fmt.Errorf("main.goä¸­æœªæ‰¾åˆ°func main() {}å£°æ˜")
//	}
//	// æ’å…¥è°ƒç”¨è¯­å¥ï¼ˆä¿æŒç¼©è¿›å’ŒåŸæœ‰ä»£ç å¯¹é½ï¼‰
//	indent := strings.Repeat("\t", strings.Count(lines[mainFuncLine], "\t")) // åŒ¹é…åŸæœ‰ç¼©è¿›
//	newLines := append(lines[:mainFuncLine+1], fmt.Sprintf("%sroutes.Init()", indent))
//	newLines = append(newLines, lines[mainFuncLine+1:]...)
//	lines = newLines
//	// 4. å†™å›main.go
//	newContent := strings.Join(lines, "\n")
//	if err := os.WriteFile(mainGoPath, []byte(newContent), 0644); err != nil {
//		return fmt.Errorf("å†™å…¥main.goå¤±è´¥ï¼š%v", err)
//	}
//	fmt.Printf("[go-common] å·²è‡ªåŠ¨ä¸ºmain.goæ³¨å…¥routes.Init()è°ƒç”¨\n")
//	// 3. æ³¨å…¥åå†æ¬¡æ£€æŸ¥ï¼Œç¡®ä¿åªå†™å…¥ä¸€æ¬¡
//	newHasValid, _ := CheckMainHasValidRoutesInit(mainGoPath, moduleName, outputDir)
//	if !newHasValid {
//		return fmt.Errorf("æ³¨å…¥åä»æœªæ£€æµ‹åˆ°æœ‰æ•ˆä»£ç ")
//	}
//
//	return nil
//}
//
//// CheckMainHasValidRoutesInit ç²¾å‡†æ£€æŸ¥ï¼šè¿‡æ»¤æ³¨é‡Šï¼Œåªè¯†åˆ«æœ‰æ•ˆä»£ç 
//// è¿”å›å€¼ï¼šhasValidï¼ˆæ˜¯å¦æœ‰æ•ˆå¯¼å…¥+è°ƒç”¨ï¼‰ã€errï¼ˆé”™è¯¯ï¼‰
//func CheckMainHasValidRoutesInit(mainGoPath, moduleName, outputDir string) (bool, error) {
//	// 1. åŠ¨æ€ç”Ÿæˆè·¯ç”±åŒ…è·¯å¾„/åˆ«å
//	routesImportPath := fmt.Sprintf("%s/%s", moduleName, outputDir)
//	routesImportPath = filepath.ToSlash(filepath.Clean(routesImportPath))
//	routesAlias := filepath.Base(outputDir)
//	if routesAlias == "." || routesAlias == "/" {
//		routesAlias = "routes"
//	}
//	// 2. è§£æASTï¼ˆä¿ç•™æ³¨é‡Šï¼Œä½†åç»­è¿‡æ»¤ï¼‰
//	fset := token.NewFileSet()
//	file, err := parser.ParseFile(fset, mainGoPath, nil, parser.ParseComments|parser.AllErrors)
//	if err != nil {
//		return false, err
//	}
//	// 3. æ£€æŸ¥ã€Œæœ‰æ•ˆã€çš„è·¯ç”±åŒ…å¯¼å…¥ï¼ˆæ’é™¤æ³¨é‡Šï¼‰
//	hasValidImport := false
//	for _, imp := range file.Imports {
//		// è·³è¿‡è¢«æ³¨é‡Šçš„å¯¼å…¥ï¼ˆimp.Comment != nil è¡¨ç¤ºå¯¼å…¥è¡Œæœ‰æ³¨é‡Šï¼‰
//		if imp.Comment != nil {
//			continue
//		}
//		// è·³è¿‡åœ¨æ³¨é‡Šå—ä¸­çš„å¯¼å…¥
//		if isNodeInComment(fset, file, imp.Pos()) {
//			continue
//		}
//		// åŒ¹é…å¯¼å…¥è·¯å¾„
//		impPath := strings.Trim(imp.Path.Value, `"`)
//		if impPath == routesImportPath {
//			hasValidImport = true
//			break
//		}
//	}
//
//	// 4. æ£€æŸ¥ã€Œæœ‰æ•ˆã€çš„routes.Init()è°ƒç”¨ï¼ˆæ’é™¤æ³¨é‡Šï¼‰
//	hasValidCall := false
//	ast.Inspect(file, func(n ast.Node) bool {
//		// è·³è¿‡æ³¨é‡ŠèŠ‚ç‚¹
//		if _, isComment := n.(*ast.Comment); isComment {
//			return false
//		}
//		if _, isCommentGroup := n.(*ast.CommentGroup); isCommentGroup {
//			return false
//		}
//
//		// åŒ¹é…mainå‡½æ•°
//		funcDecl, ok := n.(*ast.FuncDecl)
//		if !ok || funcDecl.Name.Name != "main" || funcDecl.Type.Results != nil {
//			return true
//		}
//
//		// éå†mainå‡½æ•°ä½“
//		for _, stmt := range funcDecl.Body.List {
//			// è·³è¿‡ç©ºè¯­å¥/æ³¨é‡Šç›¸å…³è¯­å¥
//			if stmt == nil {
//				continue
//			}
//
//			// åŒ¹é…è¡¨è¾¾å¼è¯­å¥ï¼ˆå¦‚ routes.Init()ï¼‰
//			exprStmt, ok := stmt.(*ast.ExprStmt)
//			if !ok {
//				continue
//			}
//
//			// åŒ¹é…å‡½æ•°è°ƒç”¨
//			callExpr, ok := exprStmt.X.(*ast.CallExpr)
//			if !ok {
//				continue
//			}
//
//			// åŒ¹é…routes.Inité€‰æ‹©å™¨
//			selExpr, ok := callExpr.Fun.(*ast.SelectorExpr)
//			if !ok {
//				continue
//			}
//
//			// åŒ¹é…åŒ…åˆ«åå’Œå‡½æ•°å
//			ident, ok := selExpr.X.(*ast.Ident)
//			if ok && ident.Name == routesAlias && selExpr.Sel.Name == "Init" {
//				// æ£€æŸ¥æ˜¯å¦åœ¨æ³¨é‡Šä¸­
//				if !isNodeInComment(fset, file, stmt.Pos()) {
//					hasValidCall = true
//					return false
//				}
//			}
//		}
//		return true
//	})
//	return hasValidImport && hasValidCall, nil
//}
//
//// isNodeInComment æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦åœ¨æ³¨é‡Šå—ä¸­
//func isNodeInComment(fset *token.FileSet, file *ast.File, pos token.Pos) bool {
//	for _, cg := range file.Comments {
//		if cg.Pos() <= pos && pos <= cg.End() {
//			return true
//		}
//	}
//	return false
//}
